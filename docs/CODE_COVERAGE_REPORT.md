# PLCopen ä»£ç è¦†ç›–ç‡æŠ¥å‘Š

**ç”Ÿæˆæ—¶é—´**: 2026-01-18
**æµ‹è¯•æ¡†æ¶**: Unity + GCC gcov
**è¦†ç›–ç‡å·¥å…·**: gcovr

---

## ğŸ“Š è¦†ç›–ç‡æ€»è§ˆ

### æ•´ä½“è¦†ç›–ç‡: **97%** âœ…

| æ¨¡å— | æ€»è¡Œæ•° | å·²æ‰§è¡Œ | è¦†ç›–ç‡ | æœªè¦†ç›–è¡Œ | çŠ¶æ€ |
|------|--------|--------|--------|----------|------|
| **common.c** | 18 | 18 | **100%** | - | âœ… å®Œç¾ |
| **fb_pid.c** | 73 | 71 | **97%** | 41, 61 | âœ… ä¼˜ç§€ |
| **fb_pt1.c** | 29 | 28 | **96%** | 13 | âœ… ä¼˜ç§€ |
| **æ€»è®¡** | **120** | **117** | **97%** | 3 è¡Œ | âœ… ä¼˜ç§€ |

---

## ğŸ¯ æ¨¡å—è¯¦ç»†åˆ†æ

### 1. common.c - åŸºç¡€åŠŸèƒ½æ¨¡å— (100%)

**è¦†ç›–æƒ…å†µ**: å®Œå…¨è¦†ç›– âœ…

**æµ‹è¯•ç”¨ä¾‹**: 14 ä¸ª
- âœ… æº¢å‡ºæ£€æµ‹ (check_overflow): 3 ä¸ªæµ‹è¯•
- âœ… å®‰å…¨é™¤æ³• (safe_divide): 4 ä¸ªæµ‹è¯•
- âœ… NaN æ£€æµ‹ (check_nan): 3 ä¸ªæµ‹è¯•
- âœ… è¾“å‡ºé™å¹… (clamp_output): 4 ä¸ªæµ‹è¯•

**ç»“è®º**: æ‰€æœ‰åŸºç¡€åŠŸèƒ½å‡è¢«å…¨é¢æµ‹è¯•ï¼Œè¾¾åˆ° 100% è¦†ç›–ç‡ã€‚

---

### 2. fb_pid.c - PID æ§åˆ¶å™¨ (97%)

**è¦†ç›–æƒ…å†µ**: 73 è¡Œä¸­ 71 è¡Œè¢«æ‰§è¡Œ

**æœªè¦†ç›–è¡Œ**:
- **ç¬¬ 41 è¡Œ**: å¯èƒ½æ˜¯å‚æ•°éªŒè¯çš„è¾¹ç•Œæ¡ä»¶
- **ç¬¬ 61 è¡Œ**: å¯èƒ½æ˜¯é”™è¯¯å¤„ç†æˆ–ç‰¹æ®ŠçŠ¶æ€åˆ†æ”¯

**æµ‹è¯•ç”¨ä¾‹**: 18 ä¸ª
- âœ… é…ç½®éªŒè¯ (5): è¦†ç›–å¤§éƒ¨åˆ†å‚æ•°æ£€æŸ¥
- âœ… æ§åˆ¶åŠŸèƒ½ (3): P/I/D åˆ†é‡è®¡ç®—
- âœ… æŠ—é¥±å’Œ (2): æ¡ä»¶ç§¯åˆ†æ³•
- âœ… æ‰‹è‡ªåŠ¨æ¨¡å¼ (2): æ¨¡å¼åˆ‡æ¢
- âœ… æ•°å€¼ä¿æŠ¤ (2): NaN/Inf æ£€æµ‹
- âœ… çŠ¶æ€ç  (3): OK/LIMIT_HI/LIMIT_LO
- âœ… é¦–æ¬¡è°ƒç”¨ (1): æ— å†²å‡»å¯åŠ¨

**ç»“è®º**: 97% è¦†ç›–ç‡å·²è¾¾åˆ°ä¼˜ç§€æ°´å¹³ï¼Œæœªè¦†ç›–çš„ 2 è¡Œå¯èƒ½æ˜¯æç«¯è¾¹ç•Œæ¡ä»¶ã€‚

---

### 3. fb_pt1.c - PT1 æ»¤æ³¢å™¨ (96%)

**è¦†ç›–æƒ…å†µ**: 29 è¡Œä¸­ 28 è¡Œè¢«æ‰§è¡Œ

**æœªè¦†ç›–è¡Œ**:
- **ç¬¬ 13 è¡Œ**: å¯èƒ½æ˜¯é”™è¯¯å¤„ç†åˆ†æ”¯

**æµ‹è¯•ç”¨ä¾‹**: 10 ä¸ª
- âœ… é…ç½®éªŒè¯ (3): æ—¶é—´å¸¸æ•°ã€é‡‡æ ·å‘¨æœŸæ£€æŸ¥
- âœ… é˜¶è·ƒå“åº” (2): 1Ï„ å’Œ 3Ï„ ç†è®ºéªŒè¯
- âœ… å™ªå£°æŠ‘åˆ¶ (1): å°–å³°ä¿¡å·æ»¤æ³¢
- âœ… æ•°å€¼ä¿æŠ¤ (2): NaN/Inf æ£€æµ‹
- âœ… çŠ¶æ€ç  (1): OK çŠ¶æ€éªŒè¯
- âœ… é¦–æ¬¡è°ƒç”¨ (1): æ— è·³å˜å¯åŠ¨

**ç»“è®º**: 96% è¦†ç›–ç‡éå¸¸ä¼˜ç§€ï¼Œæ ¸å¿ƒåŠŸèƒ½å®Œå…¨è¦†ç›–ã€‚

---

## ğŸ“ˆ è¦†ç›–ç‡è¶‹åŠ¿

### å½“å‰çŠ¶æ€
```
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 97%
```

### æµ‹è¯•æ‰§è¡Œç»Ÿè®¡
- **æ€»æµ‹è¯•æ•°**: 42 ä¸ª
- **é€šè¿‡**: 42 ä¸ª âœ…
- **å¤±è´¥**: 0 ä¸ª
- **å¿½ç•¥**: 0 ä¸ª
- **æˆåŠŸç‡**: 100%

---

## ğŸ¯ è¦†ç›–ç‡ç›®æ ‡è¾¾æˆæƒ…å†µ

| æŒ‡æ ‡ | ç›®æ ‡ | å®é™… | çŠ¶æ€ |
|------|------|------|------|
| æ•´ä½“è¦†ç›–ç‡ | >90% | **97%** | âœ… è¶…æ ‡ |
| æ ¸å¿ƒæ¨¡å— | >95% | **97%** (PID/PT1 å¹³å‡) | âœ… è¾¾æ ‡ |
| åŸºç¡€æ¨¡å— | 100% | **100%** (common) | âœ… å®Œç¾ |

---

## ğŸ” æœªè¦†ç›–ä»£ç åˆ†æ

### fb_pid.c æœªè¦†ç›–è¡Œ (2 è¡Œ)

å¯èƒ½çš„åŸå› ï¼š
1. **ç¬¬ 41 è¡Œ**: å¯èƒ½æ˜¯ä¸å¸¸è§¦å‘çš„è¾¹ç•Œæ¡ä»¶éªŒè¯
2. **ç¬¬ 61 è¡Œ**: å¯èƒ½æ˜¯å¤æ‚é”™è¯¯å¤„ç†è·¯å¾„

**å»ºè®®**: æ·»åŠ è¾¹ç•Œæ¡ä»¶æµ‹è¯•ç”¨ä¾‹ä»¥è¦†ç›–è¿™äº›è¡Œã€‚

### fb_pt1.c æœªè¦†ç›–è¡Œ (1 è¡Œ)

å¯èƒ½çš„åŸå› ï¼š
- **ç¬¬ 13 è¡Œ**: å¯èƒ½æ˜¯é”™è¯¯å¤„ç†åˆ†æ”¯

**å»ºè®®**: æ·»åŠ ç‰¹æ®Šé”™è¯¯åœºæ™¯æµ‹è¯•ã€‚

---

## âœ… è´¨é‡è¯„ä¼°

### ä»£ç è´¨é‡æŒ‡æ ‡

| æŒ‡æ ‡ | è¯„åˆ† | è¯´æ˜ |
|------|------|------|
| è¦†ç›–ç‡ | â­â­â­â­â­ | 97% ä¼˜ç§€ |
| æµ‹è¯•å®Œæ•´æ€§ | â­â­â­â­â­ | 42 ä¸ªå…¨é¢æµ‹è¯• |
| è¾¹ç•Œæµ‹è¯• | â­â­â­â­â˜† | å¤§éƒ¨åˆ†è¾¹ç•Œè¦†ç›– |
| é”™è¯¯å¤„ç† | â­â­â­â­â˜† | NaN/Inf å®Œå…¨è¦†ç›– |
| æ–‡æ¡£å®Œæ•´æ€§ | â­â­â­â­â­ | è¯¦ç»†æ³¨é‡Š |

### æ€»ä½“è¯„ä»·

âœ… **ä¼˜ç§€** - ä»£ç è¦†ç›–ç‡è¾¾åˆ° 97%ï¼Œè¿œè¶… 90% ç›®æ ‡
âœ… **å¯é ** - æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å‡æœ‰å®Œæ•´æµ‹è¯•
âœ… **å¥å£®** - å¼‚å¸¸å¤„ç†æµ‹è¯•å®Œå–„
âš ï¸ **å¯æ”¹è¿›** - 3 è¡Œæœªè¦†ç›–ä»£ç å¯è¿›ä¸€æ­¥ä¼˜åŒ–

---

## ğŸ“Š HTML è¯¦ç»†æŠ¥å‘Š

å®Œæ•´çš„ HTML è¦†ç›–ç‡æŠ¥å‘ŠåŒ…å«ï¼š
- æ¯ä¸ªå‡½æ•°çš„è¡Œçº§è¦†ç›–ç‡
- åˆ†æ”¯è¦†ç›–ç‡è¯¦æƒ…
- æœªæ‰§è¡Œä»£ç é«˜äº®æ˜¾ç¤º
- äº¤äº’å¼å¯¼èˆª

**æŸ¥çœ‹æ–¹å¼**:
```bash
# Windows
start build/coverage/coverage.html

# Linux/Mac
open build/coverage/coverage.html

# æˆ–åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€
file:///c:/Users/guog/github/hollysys-cn/embedded-py-runtime/build/coverage/coverage.html
```

---

## ğŸš€ åç»­æ”¹è¿›å»ºè®®

### çŸ­æœŸ (æœ¬å‘¨)
1. âœ… åˆ†æ fb_pid.c ç¬¬ 41ã€61 è¡Œæœªè¦†ç›–åŸå› 
2. âœ… åˆ†æ fb_pt1.c ç¬¬ 13 è¡Œæœªè¦†ç›–åŸå› 
3. âœ… æ·»åŠ é’ˆå¯¹æ€§æµ‹è¯•ç”¨ä¾‹

### ä¸­æœŸ (ä¸‹å‘¨)
1. â³ æ‰©å±•å®šæ—¶å™¨æ¨¡å—æµ‹è¯• (TON/TOF/TP)
2. â³ ç”Ÿæˆå®šæ—¶å™¨æ¨¡å—è¦†ç›–ç‡æŠ¥å‘Š
3. â³ ç›®æ ‡: æ•´ä½“è¦†ç›–ç‡ä¿æŒ >95%

### é•¿æœŸ
1. â³ é›†æˆåˆ° CI/CD æµç¨‹
2. â³ è®¾ç½®è¦†ç›–ç‡ä¸‹é™è­¦æŠ¥
3. â³ æŒç»­ç›‘æ§è¦†ç›–ç‡è¶‹åŠ¿

---

## ğŸ“ æµ‹è¯•å‘½ä»¤å‚è€ƒ

### ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
```bash
./scripts/docker/generate-coverage-report.sh
```

### æŸ¥çœ‹æ–‡æœ¬æŠ¥å‘Š
```bash
cat build/coverage/coverage.txt
```

### æŸ¥çœ‹ HTML æŠ¥å‘Š
```bash
start build/coverage/coverage.html
```

### æ¸…ç†è¦†ç›–ç‡æ•°æ®
```bash
find . -name '*.gcda' -delete
find . -name '*.gcno' -delete
```

---

## ğŸ† æˆå°±è§£é”

- ğŸ¯ **è¦†ç›–ç‡å¤§å¸ˆ** - æ•´ä½“è¦†ç›–ç‡ 97%
- ğŸ’¯ **å®Œç¾è¦†ç›–** - common.c è¾¾åˆ° 100%
- ğŸ“Š **è¯¦ç»†æŠ¥å‘Š** - HTML + Text åŒæ ¼å¼
- ğŸ”§ **è‡ªåŠ¨åŒ–** - ä¸€é”®ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
- âœ… **è´¨é‡ä¿è¯** - 42/42 æµ‹è¯•é€šè¿‡

---

**æ›´æ–°æ—¶é—´**: 2026-01-18
**æŠ¥å‘Šç”Ÿæˆ**: è‡ªåŠ¨åŒ– Docker ç¯å¢ƒ
**ç»´æŠ¤è€…**: Hollysys Embedded Team
